<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jeesite.modules.ems.dao.EmsMeterThresholdConfigDao">
	
	<!-- 查询数据 -->
	<select id="findList" resultType="EmsMeterThresholdConfig">
		SELECT
		b.`meter_code` AS "meterCode",
		b.`meter_name` AS "meterName",
		a.`rated_power` AS "ratedPower",
		a.`upper_warn_limit_power` AS "upperWarnLimitPower",
		a.`lower_warn_limit_power` AS "lowerWarnLimitPower",
		a.`rated_current` AS "ratedCurrent",
		a.`upper_warn_limit_current` AS "upperWarnLimitCurrent",
		a.`lower_warn_limit_current` AS "lowerWarnLimitCurrent",
		a.`rated_voltage` AS "ratedVoltage",
		a.`upper_warn_limit_voltage` AS "upperWarnLimitVoltage",
		a.`lower_warn_limit_voltage` AS "lowerWarnLimitVoltage",
		a.`rated_power_factor` AS "ratedPowerFactor",
		a.`upper_warn_limit_power_factor` AS "upperWarnLimitPowerFactor",
		a.`lower_warn_limit_power_factor` AS "lowerWarnLimitPowerFactor",
		a.`calculate_frequency` AS "calculateFrequency",
		a.`is_execute_weekend` AS "isExecuteWeekend",
		a.`upper_warn_limit_energy` AS "upperWarnLimitEnergy",
		a.`create_by` AS "createBy",
		a.`create_date` AS "createDate",
		a.`update_by` AS "updateBy",
		a.`update_date` AS "updateDate",
		a.`remarks` AS "remarks",
		a.`company_code` AS "companyCode",
		a.`company_name` AS "companyName",
		a.`corp_code` AS "corpCode",
		a.`corp_name` AS "corpName"
		FROM ems_meter b
		left join ${sqlMap.table.toSql()} on b.meter_code = a.meter_code
		<where>
			<if test="corpCode !=null and corpCode !=''">
				and b.corp_code = #{corpCode}
			</if>
			<if test="companyCode !=null and companyCode !=''">
				and b.company_code = #{companyCode}
			</if>
			<if test="meterName !=null and meterName !=''">
				and b.meter_name like concat('%',#{meterName},'%')
			</if>
		</where>
		ORDER BY b.create_date DESC
	</select>

	<select id="getById" resultType="EmsMeterThresholdConfig">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		where meter_code = #{meterCode}
		limit 1
	</select>
</mapper>