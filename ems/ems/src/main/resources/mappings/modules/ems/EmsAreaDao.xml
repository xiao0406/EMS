<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jeesite.modules.ems.dao.EmsAreaDao">
	
	<!-- 查询数据 -->
	<select id="findList" resultType="EmsArea">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		<where>
			${sqlMap.where.toSql()}
		</where>
		ORDER BY ${sqlMap.order.toSql()}
	</select>

	<select id="getById" resultType="EmsArea">
		SELECT ${sqlMap.column.toSql()}
		FROM ${sqlMap.table.toSql()}
		where area_code = #{areaCode}
		limit 1
	</select>

	<resultMap id="listMap" type="EmsArea">
		<!--team中的基本属性-->
		<id column="area_code" property="areaCode"/>
		<result column="area_name" property="areaName"/>
		<result column="parent_code" property="parentCode"/>
		<result column="company_code" property="companyCode"/>
		<result column="company_name" property="companyName"/>

		<!--关联属性的映射关系-->
		<collection property="areaMeterList" javaType="list" ofType="EmsAreaMeter">
			<id column="area_code" property="areaCode"/>
			<id column="meter_code" property="meterCode"/>
			<result column="electricity_mark" property="electricityMark"/>
		</collection>
	</resultMap>

	<sql id="listColumn">
		a.area_code,
		a.area_name,
		a.parent_code,
		a.company_code,
		a.company_name,
		eam.meter_code,
		eam.electricity_mark
	</sql>

	<sql id="listTables">
		from ems_area a
		left join ems_area_meter eam on a.area_code = eam.area_code
	</sql>

	<select id="findAllMarked" resultMap="listMap">
		SELECT
		<include refid="listColumn"></include>
		<include refid="listTables"></include>
		<where>
			${sqlMap.where.toSql()}
		</where>
		order by a.tree_sorts
	</select>
</mapper>